-- Коллеги, обратите пожалуйста внимание что данные задания нужно решать с использованием 
-- JOIN!
-- Тема “Сложные запросы”

-- 1 задание: Составьте список пользователей users, 
-- которые осуществили хотя бы один заказ orders в интернет магазине.

INSERT INTO orders (id, user_id,created_at, updated_at) 
	VALUES
		('1', '1', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('2', '2', '2020-08-21 18:43:25', '2020-11-21 18:43:25'),
  		('3', '3', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('4', '4', '2020-02-21 18:43:25', '2020-11-21 18:43:25'),
  		('5', '5', '2020-01-21 18:43:25', '2020-11-21 18:43:25'),
  		('6', '1', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('7', '4', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('8', '1', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('9', '5', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('10', '4', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('11', '1', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('12', '3', '2020-01-21 18:43:25', '2020-11-21 18:43:25'),
  		('13', '1', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('14', '4', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('15', '3', '2020-10-21 18:43:25', '2020-11-21 18:43:25'),
  		('16', '1', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('17', '2', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('18', '5', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('19', '1', '2020-10-21 18:43:25', '2020-11-21 18:43:25'),
  		('20', '2', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('21', '1', '2020-03-21 18:43:25', '2020-11-21 18:43:25'),
  		('22', '3', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('23', '1', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('24', '1', '2020-10-21 18:43:25', '2020-11-21 18:43:25'),
  		('25', '2', '2020-11-21 18:43:25', '2020-11-21 18:43:25'),
  		('26', '3', '2020-01-21 18:43:25', '2020-11-21 18:43:25'),
  		('27', '1', '2020-11-21 18:43:25', '2020-11-21 18:43:25')
; -- заполнение таблицы заказов

SELECT u.id, u.name, u.birthday_at, COUNT(*) AS orders_total
	FROM users AS u
		JOIN orders AS o
			ON u.id = o.user_id
		GROUP BY o.user_id;

	
-- 2 задание: Выведите список товаров products и разделов catalogs, который соответствует товару.
	
SELECT p.id, p.name, p.price, c.name AS catalog
  FROM products AS p
    LEFT JOIN catalogs AS c
      ON p.catalog_id = c.id;

     
-- 3 задание: (по желанию) Пусть имеется таблица рейсов flights (id, from, to) 
-- и таблица городов cities (label, name). Поля from, to и label содержат английские
-- названия городов, поле name — русское.
-- Выведите список рейсов flights с русскими названиями городов.

DROP TABLE flights;
DROP TABLE cities;

CREATE TABLE flights (
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT "Идентификатор сроки",
	`from` VARCHAR(150) NOT NULL UNIQUE COMMENT "Города вылетов",
 	`to` VARCHAR(150) NOT NULL UNIQUE COMMENT "Города прилетов"
) COMMENT "Перелеты";

INSERT INTO
	flights (`from`, `to`)
VALUES 
	('Moscow', 'Washington'),   
	('Washington', 'Ottawa'), 
	('Ottawa', 'Madrid'), 
	('Madrid', 'Rome'), 
	('Rome', 'Oslo'),
	('Oslo', 'Tallinn'), 
	('Tallinn', 'London'), 
	('London', 'Prague'), 
	('Prague', 'Paris'), 
	('Paris', 'Moscow');
						
CREATE TABLE cities (
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT "Идентификатор сроки",
	label VARCHAR(150) NOT NULL UNIQUE COMMENT "Лейбл",
 	name VARCHAR(150) NOT NULL UNIQUE COMMENT "Наименование"
) COMMENT "Деловые центры";

INSERT INTO
	cities (label, name)
VALUES 
	('Moscow', 'Москва'), 
	('Madrid', 'Мадрид'), 
	('Ottawa', 'Оттава'), 
	('Paris', 'Париж'),
	('Rome', 'Рим'),
	('Tallinn', 'Таллин'), 
	('London', 'Лондон'), 
	('Oslo', 'Осло'), 
	('Prague', 'Прага'),
	('Washington', 'Вашингтон');
	
SELECT 
	f.id, 
	c_from.name AS `from`, 
	c_to.name AS `to` 
FROM flights AS f
	JOIN cities AS c_from
		ON f.from = c_from.label
    JOIN cities AS c_to
		ON f.to = c_to.label;
